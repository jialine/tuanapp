define(["cBase","cUtility","cWidgetFactory","cStore","cHybridFacade"],function(a,b,c,d,e){"use strict";var f="Geolocation",g="0b895f63ca21c9e82eb158f46fe7f502";if(!c.hasWidget(f)){var h=h||{};h.requestGeographic=function(a,b){var c=function(b){a&&a(b)},d=function(a){var c="未能获取到您当前位置，请重试或选择城市";switch(a.code){case a.TIMEOUT:c="获取您当前位置超时，请重试或选择城市！";break;case a.PERMISSION_DENIED:c="您拒绝了使用位置共享服务，查询已取消，请开启位置共享或选择城市！";break;case a.POSITION_UNAVAILABLE:c="获取您当前位置信息失败，请重试或选择城市！"}b&&b(a,c)};window.navigator.geolocation.getCurrentPosition(c,d,{enableHighAccuracy:!0,maximumAge:5e3,timeout:2e4})},h.requestAMapAddress=function(a,b,c,d,e){var f="121.473704,31.230393";a&&b&&(f=a+","+b);var h=$.param({location:f,key:g,radius:0,extensions:"all"});e=e||8e3,$.ajax({url:"http://restapi.amap.com/v3/geocode/regeo?"+h,dataType:"jsonp",success:function(d){var e=d&&d.regeocode||"",g=e.addressComponent.city,h=e.addressComponent.province,i="";_.isString(g)?i=g:_.isString(h)&&(i=h);var j={address:_.isString(e.formatted_address)?e.formatted_address:"",location:f,info:e&&e.addressComponent,city:i,lng:a,lat:b};c&&c(j)},error:function(a){d&&d(a)},timeout:e})},h.requestAMapAround=function(a,b,c,d,e){var f="121.473704,31.230393";a&&b&&(f=a+","+b);var h=$.param({location:f,key:g,radius:500,offset:4,page:1});e=e||8e3,$.ajax({url:"http://restapi.amap.com/v3/place/around?"+h,dataType:"jsonp",success:function(a){var b=a&&a.pois||[];c&&c(b)},error:function(a){d&&d(a)},timeout:e})},h.requestAMapKeyword=function(a,b,c,d,e){var f=$.param({keywords:a,city:b,key:g,offset:10,page:1});e=e||8e3,$.ajax({url:"http://restapi.amap.com/v3/place/text?"+f,dataType:"jsonp",success:function(a){var b=a&&a.pois||[];c&&c(b)},error:function(a){d&&d(a)},timeout:e})},h.tansformLongitude=function(a,b,c,d,e){var f=$.param({locations:a+","+b,key:g,coordsys:"gps"});e=e||8e3,$.ajax({url:"http://restapi.amap.com/v3/assistant/coordinate/convert?"+f,dataType:"jsonp",success:function(a){if(a&&"1"===a.status){var b=a.locations.split(",");c&&c(b[0],b[1])}else d&&d()},error:function(a){d&&d(a)},timeout:e})},h.requestCityInfo=function(a,c,d,f,g){var i=function(){var b=function(b){if(b&&b.locateStatus){if(-1==b.locateStatus)return d("网络不通，当前无法定位",1),void 0;if(-2==b.locateStatus)return d("定位没有开启",2),void 0}b&&b.value&&b.value.poi&&(b.value.poi.address&&""!=b.value.poi.address?b.value.addrs=b.value.poi.address:b.value.poi.name&&""!=b.value.poi.name&&(b.value.addrs=b.value.poi.name),b.value.poi.y&&""!=b.value.poi.y&&(b.value.lat=b.value.poi.y),b.value.poi.x&&""!=b.value.poi.x&&(b.value.lng=b.value.poi.x));var e=null;b&&b.value&&b.value.ctyName?e=b.value.ctyName:b&&b.value&&b.value.cityName?e=b.value.cityName:b&&b.value&&"香港特別行政區"==b.value.province?e="香港特別行政區":b&&b.value&&b.value.province&&(e=b.value.province.indexOf("市")>-1?b.value.province:b.value.subLocality);var f=null;b&&b.value&&b.value.addrs&&(f=b.value.addrs);var g=b.value.lat,i=b.value.lng;if(e&&f)f.indexOf(e)>-1?a({city:e,address:f,lng:i,lat:g}):a({city:e,address:e+f,lng:i,lat:g});else if(g&&i){var j=function(b){a&&(b.lng=i,b.lat=g,a(b))},k=function(){c&&c()};h.requestAMapAddress(i,g,j,k)}else d("Error",0)},d=function(a,b){return"function"==typeof f?(f(a,b),void 0):(c&&c(b),void 0)};e.request({name:e.METHOD_LOCATE,success:b,error:d})},j=function(){var b=function(b){var e=b.coords.longitude,f=b.coords.latitude;d&&d(e,f);var i=function(b){a&&a(b)},j=function(){c&&c()};g?h.tansformLongitude(e,f,function(a,b){h.requestAMapAddress(a,b,i,j)},function(a){j(a)}):h.requestAMapAddress(e,f,i,j)},e=function(a,b){return"function"==typeof f?(f(b,a),void 0):(c&&c(b),void 0)};h.requestGeographic(b,e)},k=b.isInApp()?i:j;k()},h.requestAroundInfo=function(a,b,c){var d=a.split(",")[0],e=a.split(",")[1],f=function(a){b&&b(a)},g=function(){c&&c()};h.requestAMapAround(d,e,f,g)},h.requestKeywordInfo=function(a,b,c,d){var e=function(a){c&&c(a)},f=function(){d&&d()};h.requestAMapKeyword(a,b,e,f)};var i=h.PositionStore=a.Class(d,{__propertys__:function(){this.key="POSITION_CITY",this.lifeTime="10M"},initialize:function(a,b){a(b)}});h.requestCacheCityInfo=function(a,b,c){var d=i.getInstance(),e=d.get();e?a&&a.call(c,e):h.requestCityInfo(function(b){d.set(b),a&&a.call(c,b)},function(a,d){b&&b.call(c,a,d)})},c.register({name:f,fn:h})}});