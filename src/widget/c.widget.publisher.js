define(["cUtility","cWidgetFactory","CommonStore"],function(a,b,c){"use strict";var d="Publisher",e=!1;if(!b.hasWidget(d)){var f=f||{},g={non_member_login:function(a){h.non_member_login=function(b){a.callback(b)}},locate:function(a){h.locate=function(b){try{var c=b;"string"==typeof b&&(c=JSON.parse(b)),a.success(c)}catch(d){a.error(!0,"定位失败")}}},login:function(a){h.login=function(b){"string"==typeof b&&(b=JSON.parse(b));var d=c.UserStore.getInstance();d.getUser(),d.setUser(b.data);var e=c.HeadStore.getInstance(),f=e.get();f.auth=b.data.Auth,e.set(f),"function"==typeof a.success&&a.success()}},back:function(a){h.back=a.callback},commit:function(a){h.commit=a.callback}},h={refresh:function(){window.location.reload()}},i={non_member_login:function(a){"function"==typeof h.non_member_login&&h.non_member_login(a)},locate:function(a){"function"==typeof h.locate&&h.locate(a)},login:function(a){"function"==typeof h.login&&h.login(a)},back:function(){"function"==typeof h.back&&h.back()},commit:function(){"function"==typeof h.commit&&h.commit()}},j={callback:function(a){if(!e){var b=a;if("string"==typeof a)try{b=JSON.parse(window.decodeURIComponent(a))}catch(c){setTimeout(function(){console.error("参数错误")},0)}document.activeElement.blur(),"function"==typeof i[b.tagname]&&i[b.tagname](b.param)}}},k=function(a){for(var b in j)a[b]=a[b]||j[b]};f.setApi=function(){if(a.isInApp()){var b=window.app=window.app||{};k(b)}},f.register=function(b){a.isInApp()&&"function"==typeof g[b.name]&&g[b.name](b)},f.lock=function(){a.isInApp()&&(e=!0)},f.unlock=function(){a.isInApp()&&(e=!1)},f.requestEntryInfo=function(){a.isInApp()&&app_entry()},f.requestAnomyousUser=function(){a.isInApp()&&app_non_member_login()},f.monitor=function(b){a.isInApp()&&app_log_event(b)},f.sendHotelInfo=function(b,c,d,e){a.isInApp()&&app_go_to_hotel_detail(b,c,d,e)},f.requestAutoLogin=function(){a.isInApp()&&app_member_auto_login()},b.register({name:d,fn:f})}});