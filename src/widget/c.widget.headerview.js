define(["cBase","cUICore","cWidgetFactory","cUtility","cSales","cHybridFacade"],function(a,b,c,d,e,f){"use strict";function g(c){if(g.instance)return g.instance.reset(c),g.instance;var d=new a.Class(b.AbstractView,k);return g.instance=new d(c)}var h="HeaderView";if(!c.hasWidget(h)){var i=function(){var a=this.templateFactory(this.data);return $(a)},j=function(a){if(this.html="",a&&a.data){for(var b in this.htmlMap)a.data[b]&&(this.html+=this.htmlMap[b]);var c="",d=a.data.style;d&&(c=' style="'+d+'"'),this.html="<header"+c+">"+this.html+"</header>"}},k=k||{};k.__propertys__=function(){},k.initialize=function(a,b){b?(this.rootBox=b.container||$('<div id="headerview"></div>'),this.data=b.data,this.html=b.html||this.html,this.data&&(this.bindEvents=b.data.bindEvents||function(){}),j.call(this,b),b.onShow=this.onShow):(this.rootBox=$('<div id="headerview"></div>'),b={onShow:this.onShow}),a(b)},k.createHtml=function(){return this.html?(this.templateFactory=this.template(this.html),i.call(this)):void 0},k.onShow=function(){if(this.rootBox.off("click"),this.data&&this.data.btn&&"function"==typeof this.bindEvents&&(console.log("onshow"),this.bindEvents(this.getView())),this.data&&this.data.events&&this.delegateEvents(this.data.events,this.data.view),this.data&&this.data.commit){var a=this.data.commit,b=this.getView(),c=this,d=function(){a.callback.call(c.view)};b.find("#"+a.id).on("click",d),f.register({tagname:f.METHOD_COMMIT,callback:d})}},k.set=function(a){a&&(this.data=a,j.call(this,{data:a}),this.bindEvents=this.data.bindEvents,this.isCreate=!1,this.hide())},k.reset=function(a){a&&(this.set(a),this.trigger("onShow"))},k.delegateEvents=function(a,b){if(a){l.call(this,"#c-ui-header-home","click",a.homeHandler,b),l.call(this,"#c-ui-header-return","click",a.returnHandler,b);var c=this,d=function(){a.returnHandler.call(b||c)};f.register({tagname:f.METHOD_BACK,callback:d})}};var l=function(a,b,c,d){this.rootBox.find(a).on(b,function(){c.call(d||this)})};k.getView=function(){return this.rootBox},k.updateHeader=function(a,b){this.data[a]=b,this.set(this.data),this.show()},k.html=null,k.htmlMap={home:'<i class="icon_home i_bef" id="c-ui-header-home"></i>',tel:'<a href="tel:<%=tel.number||4000086666 %>" class="icon_phone i_bef __hreftel__" id="c-ui-header-tel"></a>',title:"<h1><%=title %></h1>",back:'<i id="c-ui-header-return" class="returnico i_bef"></i>',btn:'<i id="<%=btn.id%>" class="<%=btn.classname%>"><%=btn.title %></i>',custom:"<%=custom %>"},k.create=function(){this.isCreate||this.status===b.AbstractView.STATE_ONCREATE||(this.rootBox=this.rootBox||$("body"),this.rootBox.empty(),this.root=$(this.createHtml()),this.rootBox.append(this.root),setTimeout($.proxy(function(){e.replaceContent(this.root)},this),200),this.rootBox.css("height",this.root.css("height")),this.trigger("onCreate"),this.status=b.AbstractView.STATE_ONCREATE,this.isCreate=!0)},k.showAction=function(a){d.isInApp()?(this.rootBox.hide(),this.saveHead()):this.root.show(),a()},k.saveHead=function(){var a={left:[],center:[],right:[]},b=this.data;b.back&&a.left.push({tagname:"back"}),b.title&&a.center.push({tagname:"title",value:b.title}),b.btn&&a.right.push({tagname:"commit",value:b.btn.title}),b.tel&&a.right.push({tagname:"call"}),b.home&&a.right.push({tagname:"home"});try{var c=JSON.stringify(a);f.request({name:f.METHOD_REFRESH_NAV_BAR,config:c})}catch(d){}},c.register({name:h,fn:g})}});