define(["cBase"],function(){var a=function(a){a=a||{},this._checkEventCompatibility(),this._setBaseParam(a),this._addEvent(),this._initScrollBar()};return a.prototype={constructor:a,_checkEventCompatibility:function(){var a="ontouchstart"in document.documentElement;this.start=a?"touchstart":"mousedown",this.move=a?"touchmove":"mousemove",this.end=a?"touchend":"mouseup",this.startFn,this.moveFn,this.endFn},_setBaseParam:function(a){this.timeGap=0,this.touchTime=0,this.isMoveing=!1,this.moveState="up",this.oTop=0,this.curTop=0,this.mouseY=0,this.animateParam=a.animateParam||[10,8,6,5,4,3,2,1,0,0,0],this.cooling=!0,this.steplen=25,this.wrapper=a.wrapper||$("body"),this.dragEl=a.body,this.dragEl.css("position","absolute"),this.wrapper.append(this.dragEl)},_initScrollBar:function(){return this.dragHeight||(this.dragHeight=this.dragEl.offset().height,this.wrapperHeight=this.wrapper.offset().height),this.scrollProportion=this.wrapperHeight/this.dragHeight,this.isNeedScrollBar=!0,this.scrollProportion>=1?(this.isNeedScrollBar=!1,!1):(this.scrollBar=$('<div style="background-color: rgba(0, 0, 0, 0.498039);border: 1px solid rgba(255, 255, 255, 0.901961); width: 5px; border-radius: 3px;  position: absolute; right: 1px; opacity: 0.2;  "></div>'),this.wrapper.append(this.scrollBar),this.scrollHeight=parseInt(this.scrollProportion*this.wrapperHeight),this.scrollBar.css("height",this.scrollHeight),void 0)},_setScrollTop:function(a,b){if(this.isNeedScrollBar){a=this._getResetData(a).top,a=0>a?a+10:a;var c=-1*a;if("number"==typeof b){var d=parseInt(c*this.scrollProportion)+"px";this.scrollBar.animate({top:d,right:"1px"},b,"linear")}else this.scrollBar.css("top",parseInt(c*this.scrollProportion)+"px");this.scrollBar.css("opacity","0.8")}},_hideScroll:function(){this.isNeedScrollBar&&this.scrollBar.animate({opacity:"0.2"})},_addEvent:function(){var a=this;this.startFn=function(b){a._touchStart.call(a,b)},this.moveFn=function(b){a._touchMove.call(a,b)},this.endFn=function(b){a._touchEnd.call(a,b)},this.dragEl[0].addEventListener(this.start,this.startFn,!1),document.addEventListener(this.move,this.moveFn,!1),document.addEventListener(this.end,this.endFn,!1)},removeEvent:function(){this.dragEl[0].removeEventListener(this.start,this.startFn),document.removeEventListener(this.move,this.moveFn),document.removeEventListener(this.end,this.endFn)},_touchStart:function(a){if(this.isMoveing)return a.preventDefault(),!1;this.cooling=!1,this.touchTime=a.timeStamp,pos=this.getMousePos(a.changedTouches&&a.changedTouches[0]||a);var b=parseFloat(this.dragEl.css("top"))||0;this.mouseY=pos.top-b},_touchMove:function(a){if(this.cooling)return a.preventDefault(),!1;this.isMoveing=!0,a.preventDefault();var b=this.getMousePos(a.changedTouches&&a.changedTouches[0]||a);if(Math.abs(b.top-this.mouseY-this.curTop)<10)return a.preventDefault(),!1;this.curTop=b.top-this.mouseY;var c=this._getResetData(this.curTop);c.needReset&&(this.curTop=this._resetEdge(this.curTop)),this.dragEl.css("top",this.curTop+"px"),this._setScrollTop(this.curTop),a.preventDefault()},_touchEnd:function(a){if(this.cooling)return a.preventDefault(),!1;if(Math.abs(this.oTop-this.curTop)<10)return a.preventDefault(),!1;this.cooling=!0;var b=this;this.timeGap=a.timeStamp-this.touchTime;var c=this.oTop<this.curTop?1:-1;this.moveState=c>0?"up":"down";var d=parseInt(this.timeGap/10-10);d=d>0?d:0;var e=this.animateParam[d]||0,f=e*this.steplen*c,g=this.curTop;g+=f;var h=this._getResetData(g);if(h.needReset&&(g=this._resetEdge(g),e=0),this.oTop!=this.curTop&&this.curTop!=g){var i=100+20*e;g+=f,this.dragEl.animate({top:g+"px"},i,"linear",function(){b.reset.call(b,g)}),this._setScrollTop(g,i)}else this.isMoveing=!1,this.oTop=g,this.reset(g),this.cooling=!1;this._hideScroll(),a.preventDefault()},_resetEdge:function(a){var b=parseInt(this.wrapperHeight/3),c=parseInt(-1*this.dragHeight+this.wrapperHeight*(2/3));return a>0&&a>b&&(a=b),0>a&&c>a&&(a=c),a},_getResetData:function(a){var b=!1;return a<-1*(this.dragHeight-this.wrapperHeight)&&(a=-1*(this.dragHeight-this.wrapperHeight),b=!0),a>0&&(a=0,b=!0),{top:a,needReset:b}},reset:function(a){var b=this,c=this._getResetData(a).needReset,a=this._getResetData(a).top;c?b.dragEl.animate({top:a+"px"},50,"linear",function(){b._reset(a)}):b._reset(a)},_reset:function(a){this.oTop=a,this.curTop=a,this.isMoveing=!1,this.cooling=!1},getMousePos:function(a){var b,c;return b=Math.max(document.body.scrollTop,document.documentElement.scrollTop),c=Math.max(document.body.scrollLeft,document.documentElement.scrollLeft),{top:b+a.clientY,left:c+a.clientX}}},a});