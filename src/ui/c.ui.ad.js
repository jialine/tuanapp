!function(){var a={t:1500,hasApp:!1,key:"HAS_CTRIP_APP",appProtocol:"ctrip://wireless",openApp:function(b,c,d){var e=a.getAppData();if(e&&""!=e)return e.hasApp?"function"==typeof b?b()&&(window.location=d):window.location=d:"function"==typeof c&&c(),"";var f=Date.now(),g=navigator.userAgent?navigator.userAgent.toLocaleLowerCase():"",h=-1!=g.indexOf("android",0)||-1!=g.indexOf("adr",0)?1:0,i=h&&-1!=g.indexOf("chrome",0),j=$('<iframe style="display: none;"></iframe>');j.attr("src",d),$("body").append(j),i?(setTimeout(function(){"function"==typeof c&&c()},1),window.location.href=d):setTimeout(function(){a.testApp(f)},a.t),a.setTestResult(b,c)},testApp:function(b){var c=Date.now();(!b||c-b<a.t+200)&&(a.hasApp=!1)},setTestResult:function(b,c){setTimeout(function(){a.hasApp?"function"==typeof b&&b():"function"==typeof c&&c();var d=new Date;d.setHours(d.getHours()+1);var e={value:{hasApp:a.hasApp},timeout:d.toUTCString()};window.localStorage.setItem(a.key,JSON.stringify(e)),window.hasApp=a.hasApp},a.t+1e3)},getAppData:function(){return""}};window.AppUtility=a}();var adOptions=adOptions||{};if(adOptions.__propertys__=function(){},adOptions.initialize=function(a,b){this.data=b||{},this.storeKey="APP_DOWNLOAD",a(b)},adOptions.update=function(a){this.isInFooter&&(this.remove(),this.isCreate=!1),this.rootBox=a.rootBox,this.root||(this.root=this.rootBox),this.isInFooter=!!this.rootBox.hasClass("js_in_Footer"),this.addEvent&&(this.removeEvent("onShow"),this.addEvent("onShow",this.onShow))},adOptions.createHtml=function(){var a=adOptions.getUrlParam("sourceid"),b=(adOptions.getUrlParam("sales"),adOptions.getUrlParam("allianceid")),c=adOptions.getUrlParam("sid"),d=this.isInFooter?"":"fix_bottom",e="/market/download.aspx?from=H5",f=adOptions._get("SALES_OBJECT"),g=adOptions._get("UNION"),h=adOptions._getCookie("UNION"),i="";if(b&&b.length>0&&c&&c.length>0&&(i="display:none;"),(g||h)&&(i="display:none;"),f&&f.sid&&+f.sid>0&&((!f.appurl||f.appurl.length<=0)&&(i="display:none;"),e=f.appurl?f.appurl:"/market/download.aspx?from="+f.sid),a&&a.length>0){for(var j=0,k=["497","1107","1108","3516","3512","3511","3503","3513","1595","1596","3524","3517","3518","1591","1825","1826","1827","1828","1829","1830","1831","1832","1833"],l=0,m=k.length;m>l;l++){var n=k[l];if(n==a){j=1;break}}j&&(i="display:none;")}return adOptions.isAutoDown(f.sid)&&(i="display:none;"),0==this.checkDeviceSupport()&&(i="display:none;"),i.length>0?($("footer")&&$("footer").removeClass("pb85"),$('div[data-role="footer"]')&&$('div[data-role="footer"]').removeClass("pb85"),$("#panel-box")&&$("#panel-box").removeClass("pb85"),$(".f_list")&&$(".f_list").removeClass("pb85"),adOptions.saveExpire(1),""):['<div id="dl_app" style="'+i+'" class="',d,'"> <div id="icon_text" class="txt_middle"><img src="http://res.m.ctrip.com/html5/content/images/icon_text_s6.png"/></div>',' <a href="'+e+'" id="app_link" class="txt_middle __appaddress__"><img src="http://res.m.ctrip.com/html5/content/images/icon_open_s6.png"/></a>','<div id="close_icon"></div>',"</div>"].join("")},adOptions.getUrlParam=function(a){var b=document.location.href||"",c=new RegExp("(\\?|&)"+a+"=([^&]+)(&|$)","i"),d=b.match(c);return d?d[2]:""},adOptions.setAppUrl=function(){var a=adOptions._get("SALES_OBJECT"),b=AppUtility.appProtocol,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=$("#page_id").val(),q=new RegExp("-","g"),r=new RegExp("/","g");if(p&&+p>0){if((212092==+p||212093==+p||212094==+p)&&(c=212092==+p?"hotel_inquire":212093==+p?"hotel_inland_list":212094==+p?"InlandHotel":"",d=window.localStorage?window.localStorage.getItem("HOTELSEARCHINFO"):null,d&&(d=JSON.parse(d),212092==+p&&(d.data&&(e=d.data.CheckInDate.replace(q,""),f=d.data.CheckOutDate.replace(q,""),g=d.data.CheckInCityID,h=d.data.DistrictId?+d.data.DistrictId<=0?"":d.data.DistrictId:"",i=d.data.BrandId,j=d.data.BrandName,k=0),c+="?c1="+(e||"")+"&c2="+(f||"")+"&c3="+(g||"")+"&c4="+(h||"")+"&c5="+(i||"")+"&c6="+(j||"")+"&c7="+(k||"")),212093==+p&&(d.data&&(e=d.data.CheckInDate.replace(q,""),f=d.data.CheckOutDate.replace(q,""),g=d.data.CheckInCityID,h=d.data.DistrictId?+d.data.DistrictId<=0?"":d.data.DistrictId:"",i=0,j=d.data.BrandId?+d.data.BrandId<=0?"":d.data.BrandId:"",k=d.data.BrandName||"",l=0),c+="?c1="+(e||"")+"&c2="+(f||"")+"&c3="+(g||"")+"&c4="+(h||"")+"&c5="+(i||"")+"&c6="+(j||"")+"&c7="+(k||"")),212094==+p))){d.data&&(e=d.data.CheckInDate.replace(q,""),f=d.data.CheckOutDate.replace(q,""),g=d.data.CheckInCityID);var s=window.localStorage?window.localStorage.getItem("HOTELDETAIL"):null;s&&(s=JSON.parse(s),s&&s.data&&(h=s.data.HotelID)),c+="?checkInDate="+(e||"")+"&checkOutDate="+(f||"")+"&cityId="+(g||"")+"&hotelId="+(h||"")}(212001==+p||214008==+p)&&(c=212001==+p?"hotel_groupon_list":214008==+p?"hotel_groupon_detail":"",212001==+p&&(d=window.localStorage?window.localStorage.getItem("TUAN_SEARCH"):null,d=d?JSON.parse(d):null,e=d&&d.value?d.value.ctyId:"2",c+="?c1="+(e||"2")),214008==+p&&(d=window.localStorage?window.localStorage.getItem("TUAN_DETAILS"):null,d=d?JSON.parse(d):null,e=d&&d.value?d.value.id:null,c+="?c1="+(e||""))),(212003==+p||212004==+p||212009==+p||214019==+p)&&(d=window.localStorage?window.localStorage.getItem("FLIGHT_SEARCH"):null,d=d?JSON.parse(d):null,d&&d.value&&d.value._items&&d.value._items.length>0&&(e=d.value.tripType,f=d.value._items[0].dCtyId,g=d.value._items[0].aCtyId,h=d.value._items[0].date.replace(r,""),e&&+e>1&&d.value._items.length>1&&(i=d.value._items[1].date.replace(r,"")),j="",k="",l="",m="",n="",o=""),212003==+p&&(c="flight_inquire"),(212009==+p||212004==+p)&&(c=e&&+e>1?"flight_inland_tolist":"flight_inland_singlelist"),214019==+p&&(c=e&&+e>1?"flight_int_tolist":"flight_int_singlelist"),c+="?c1="+(e||"")+"&c2="+(f||"")+"&c3="+(g||"")+"&c4="+(h||"")+"&c5="+(i||"")+"&c6="+(j||"")+"&c7="+(k||"")+"&c8="+(l||"")+"&c9="+(m||"")+"&c10="+(n||"")+"&c11="+(o||""))}return b+=c?"/"+c:"",b.indexOf("?")<=-1&&(b+="?v=2"),b+=a&&a.sid&&+a.sid>0?"&extendSourceID="+a.sid:"&extendSourceID=8888"},adOptions.onShow=function(){this.root.off("click"),this.root.find("#close_icon").on("click",$.proxy(function(){this.saveExpire(1),this.hide(),$("footer")&&$("footer").removeClass("pb85"),$("#panel-box")&&$("#panel-box").removeClass("pb85"),$('div[data-role="footer"]')&&$('div[data-role="footer"]').removeClass("pb85"),$(".f_list")&&$(".f_list").removeClass("pb85")},this));var a=this;this.root.find("#app_link").on("click",function(b){b.preventDefault();var c=$(this).attr("href"),d=adOptions.setAppUrl(),e=navigator.userAgent?navigator.userAgent.toLocaleLowerCase():"",f=-1!=e.indexOf("mac",0)||-1!=navigator.userAgent.indexOf("ios",0)?1:0;return f?(window.location=d,setTimeout(function(){window.location="itms-apps://itunes.apple.com/cn/app/id379395415?mt=8"},30)):AppUtility.openApp(function(){return a.saveExpire(),!0},function(){window.location=c},d),!1}),0==this.checkDeviceSupport()&&("dl_app"==this.root.attr("id")&&this.root.hide(),$("footer")&&$("footer").removeClass("pb85"),$('div[data-role="footer"]')&&$('div[data-role="footer"]').removeClass("pb85"),$("#panel-box")&&$("#panel-box").removeClass("pb85"),$(".f_list")&&$(".f_list").removeClass("pb85"))},adOptions.checkDeviceSupport=function(){var a=navigator.userAgent?navigator.userAgent.toLocaleLowerCase():"",b=-1!=a.indexOf("mac",0)||-1!=navigator.userAgent.indexOf("ios",0)?1:0,c=-1!=a.indexOf("android",0)||-1!=a.indexOf("adr",0)?1:0;return 0==b&&0==c?!1:!0},adOptions.saveExpire=function(a){var b={isExpire:1},c=new Date;a&&(b.isClose=a),c.setDate(c.getDate()+1),this.storeKey||(this.storeKey="APP_DOWNLOAD"),this._set(this.storeKey,b,c.toUTCString())},adOptions.saveAutoDown=function(a){var b={isAutoDown:1,sid:a},c=new Date;c.setDate(c.getDate()+1),this._set("APP_AUTODOWNLOAD",b,c.toUTCString())},adOptions.appDownload=function(){var a=adOptions._get("SALES_OBJECT"),b=AppUtility.appProtocol;b+=a&&a.sid&&+a.sid>0?"?extendSourceID="+a.sid:"?extendSourceID=8888";var c=navigator.userAgent?navigator.userAgent.toLocaleLowerCase():"",d=-1!=c.indexOf("mac",0)||-1!=navigator.userAgent.indexOf("ios",0)?1:0;d?(window.location=b,setTimeout(function(){window.location="itms-apps://itunes.apple.com/cn/app/id379395415?mt=8"},30)):AppUtility.openApp(function(){return!0},function(){var b="http://m.ctrip.com/market/download.aspx?from=H5";a&&(a.appurl&&a.appurl.length>0?b=a.appurl:a.sid&&+a.sid>0&&(b="http://m.ctrip.com/market/download.aspx?from="+a.sid)),window.location.href=b},b)},adOptions.checkForceDownload=function(a){var b=this;if(!(!a||a.length<=0||0>=+a)){var c=adOptions._get("SALES_OBJECT"),d=AppUtility.appProtocol;if(d+=c&&c.sid&&+c.sid>0?"?extendSourceID="+c.sid:"?extendSourceID=8888",navigator.connection&&navigator.connection.type!=navigator.connection.WIFI)return adOptions.saveExpire(1),adOptions.saveAutoDown(a),void 0;if(adOptions.isAutoDown(a))return adOptions.saveExpire(1),adOptions.saveAutoDown(a),void 0;var e=navigator.userAgent?navigator.userAgent.toLocaleLowerCase():"",f=-1!=e.indexOf("mac",0)||-1!=navigator.userAgent.indexOf("ios",0)?1:0;f?(window.location=d,setTimeout(function(){window.location="itms-apps://itunes.apple.com/cn/app/id379395415?mt=8"},30)):AppUtility.openApp(function(){return adOptions.saveExpire(1),adOptions.saveAutoDown(a),"dl_app"==b.root.attr("id")&&b.root.hide(),!0},function(){var d=-1!=e.indexOf("android",0)||-1!=e.indexOf("adr",0)?1:0;if(d){var f="http://m.ctrip.com/market/download.aspx?from="+a+"&App=3";c&&c.sid&&+c.sid>0&&+c.sid==+a&&c.appurl&&c.appurl.length>0&&(f=c.appurl),adOptions.saveExpire(1),adOptions.saveAutoDown(a),"dl_app"==b.root.attr("id")&&b.root.hide(),window.location.href=f}},d)}},adOptions.create=function(){if(this.isCreate||this.isExpire()||this.status===this.STATE_ONCREATE)$("footer")&&$("footer").removeClass("pb85"),$("#panel-box")&&$("#panel-box").removeClass("pb85"),$(".f_list")&&$(".f_list").removeClass("pb85"),$('div[data-role="footer"]')&&$('div[data-role="footer"]').removeClass("pb85");else{var a=this.createHtml();a&&a.length>0&&(this.root=$(a),this.rootBox.append(this.root),this.trigger("onCreate")),this.isCreate=!0}},adOptions.isExpire=function(){var a=this._get(this.storeKey);return a&&a.isClose?!0:!1},adOptions.isAutoDown=function(){var a=this._get("APP_AUTODOWNLOAD");return a&&a.isAutoDown?!0:!1},adOptions._getCookie=function(a){var b=null;if(a){var c=new RegExp("\\b"+a+"=([^;]*)\\b"),d=c.exec(document.cookie);b=d&&unescape(d[1])}else{var e,f,g=document.cookie.split(";");for(b={},e=0,len=g.length;len>e;e++)f=g[e].split("="),b[f[0]]=unescape(f[2])}return b},adOptions._get=function(a){var b=window.localStorage.getItem(a);return b&&(b=JSON.parse(b),Date.parse(b.timeout)>=new Date)?b.value||b.data:""},adOptions._set=function(a,b,c){var d={value:b,timeout:c};window.localStorage.setItem(a,JSON.stringify(d))},window.location.pathname.indexOf("webapp")>-1||window.localStorage.getItem("isInApp"))define(["cBase","cUIAbstractView","libs","cStore"],function(a,b){var c=new a.Class(b,adOptions);return c.getInstance=function(){return this.instance?this.instance:this.instance=new this},c});else{adOptions.show=function(){this.status="",this.create(),this.onShow()},adOptions.hide=function(){this.root.hide()},adOptions.trigger=function(){},adOptions.remove=function(){$("#dl_app").remove()};var config={rootBox:$("#footer")};adOptions.initialize(function(){},config);var AdView=adOptions;AdView.update(config),AdView.show()}