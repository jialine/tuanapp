define(["cBase","cStorage","libs","CommonStore","cUtility","cModel"],function(a,b,c,d,e,f){function g(a){var b=".__hreftel__",c=".__conttel__",d=".__appaddress__";$(a[0]).find(b).each(function(){this.href=w(this.href)}),$(a[0]).find(c).each(function(){var a=$(this);a.html(w(a.html()))}),$(d).each(function(){var a=x();if(!a)switch(!0){case t:a=$(this).attr("data-ios-app");break;case u:a=$(this).attr("data-android-app");break;case v:a=$(this).attr("data-win-app")}a&&$(this).attr("href",a)})}var h=null,i=d.SalesObjectStore.getInstance(),j=function(a){return f.baseurl(a)},k=function(c,d,e){var f=i.get(c);if(f)h=f,d&&d(f);else{var g=j(),k="http://"+(g&&g.domain)+"/html5/ClientData/GetSalesInfo/"+c;$.ajax({url:k,type:"GET",dataType:"json",success:$.proxy(function(f){var g={};if(1==f.ServerCode){if(f.Data){for(var j in f.Data)g[j.toLowerCase()]=f.Data[j];f.Data=g,i.set(f.Data,c);var k=30;!f.Data||"ydwxcs"!==f.Data.sales&&"1622"!==f.Data.sales||(k=5),b.localStorage.oldSet("SALESOBJ",JSON.stringify({data:f.Data,timeout:new a.Date(a.getServerDate()).addDay(k).format("Y/m/d H:i:s")}))}h=f.Data,d&&d(f.Data)}else e&&e(f)},this),error:$.proxy(function(a){e&&e(a)},this)})}},l=function(){return h},m=function(a){d.SalesStore.getInstance().set({sales:a})},n=function(a){d.SalesStore.getInstance().set({sourceid:a})},o=function(a){d.UnionStore.getInstance().set(a)},p=/400\d{3}\d{4}/i,q=/400\s+\d{3}\s+\d{4}/i,r=/400-\d{3}-\d{4}/i,s=navigator.userAgent,t=!!s.match(/(ipad|iphone)/i),u=!!s.match(/android/i),v=!!s.match(/MSIE/i),w=window.replaceStrTel=function(a){var b=l();return"string"==typeof a&&b&&b.tel&&(a=a.replace(p,b.tel),a=a.replace(q,b.teltitle),b.teltitle&&(a=a.replace(r,b.teltitle.split(" ").join("-")))),a},x=function(a){var b=l();if(b){if(b.isseo&&$(".module").show(),b.appurl)return b.appurl;var a=b.sid?b.sid:b.sales;return"/market/download.aspx?from="+a}return null};return{replaceContent:g,replaceStrTel:w,setSales:m,getSales:l,getSalesObject:k,setUnion:o,setSourceId:n}});