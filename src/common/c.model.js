define(["libs","cBase","cStore","cAjax","cUtility","CommonStore"],function(a,b,c,d,e,f){var g=e.Object,h=new b.Class({__propertys__:function(){this.url=null,this.param=null,this.result=null,this.dataformat=null,this.debug=!1,this.protocol="http",this.usehead=!0,this.ajaxOnly=!1,this.contentType=h.CONTENT_TYPE_JSON,this.method="POST",this.isUserData=!1,this.baseurl=h.baseurl.call(this),this.head=f.HeadStore.getInstance(),this.ajax,this.isAbort=!1,this.OptionHanders=[]},initialize:function(a){this.assert(),this.setOption(function(a,b){switch(a){case"ajaxOnly":case"contentType":case"debug":this[a]=b}}),this.__setOption(a)},assert:function(){if(null===this.url)throw"not override url property";if(null===this.param)throw"not override param property"},setOption:function(a){"function"==typeof a&&this.OptionHanders.push(a)},__setOption:function(a){for(var b in a)for(var c=0,d=this.OptionHanders.length;d>c;c++)this.OptionHanders[c](b,a[b])},setHead:function(a){if(!a instanceof c)throw"Set head is not a store";this.head=a},getHead:function(){return this.head},setParam:function(a,b){var d={};"object"!=typeof a||b?d[a]=b:d=a;for(var e in d)this.param instanceof c?this.param.setAttr(e,d[e]):g.set(this.param,e,d[e])},getParamStore:function(){return this.param},setParamStore:function(a){if("object"!=typeof a)throw"Set param is not a store";this.param=a},getResultStore:function(){return this.result},setResultStore:function(a){if("object"!=typeof a)throw"Set result is not a store";this.result=a},clearResult:function(){this.result&&"function"==typeof this.result.remove&&this.result.remove()},getParam:function(){return this.param instanceof c?this.param.get():this.param},buildurl:function(){return this.baseurl=h.baseurl.call(this),this.protocol+"://"+this.baseurl.domain+"/"+this.baseurl.path+("function"==typeof this.url?this.url():this.url)},getTag:function(){var a=_.clone(this.getParam()||{});if(this.isUserData&&!a.cid){var b=this.head.userStore;a.cid=b.getUserId()}return JSON.stringify(a)},excute:function(a,b,c,e,f){var g,i,j,g=_.clone(this.getParam()||{}),k=this.getTag(),l=this.result&&this.result.get(k),m=this.buildurl(),n=this.head.get();this.isAbort=!1;var o=this;!l||this.ajaxOnly||c?("get"!==this.method.toLowerCase()&&this.usehead&&this.contentType!==h.CONTENT_TYPE_JSONP&&(g.head=this.head.get()),i=$.proxy(function(c){var d,f=c.head;this.contentType!==h.CONTENT_TYPE_JSONP&&this.usehead&&f.auth&&f.auth!==n.auth&&this.head.setAuth(f.auth),f&&0===f.errcode?(d=c,"function"==typeof this.dataformat&&(d=this.dataformat(c)),this.result&&this.result.set(d,k),a&&a.call(e||this,d,c)):b&&b.call(e||this,c)},this),j=$.proxy(function(a){return o.isAbort?(o.isAbort=!1,f&&f.call(e||this,a),void 0):(b&&b.call(e||this,a),void 0)},e||this),this.ajax=this.contentType===h.CONTENT_TYPE_JSON?d.cros(m,this.method,g,i,j):this.contentType===h.CONTENT_TYPE_JSONP?d.jsonp(m,g,i,j):d.post(m,g,i,j)):a.call(e||this,l)},abort:function(){this.isAbort=!0,this.ajax&&this.ajax.abort&&this.ajax.abort()}});return h.baseurl=function(){var a=location.host,b="waptest.ctrip.com",c="restapi2";return b=e.isInApp()?"1"==e.isPreProduction()?"https"==this.protocol?"restful.m.ctrip.com":"m.ctrip.com":"0"==e.isPreProduction()?"https"==this.protocol?"restful.waptest.ctrip.com":"waptest.ctrip.com":"https"==this.protocol?"restful.m.ctrip.com":"m.ctrip.com":a.match(/^m\.ctrip\.com/i)?"m.ctrip.com":!a.match(/^(localhost|172\.16|127\.0)/i)||"https"!=location.protocol&&"https"!=this.protocol?a.match(/^(localhost|172\.16|127\.0)/i)?"https"==this.protocol?"restful.waptest.ctrip.com":"waptest.ctrip.com":a.match(/^10\.8\.2\.111/i)?"10.8.2.111":!a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)||"https"!=location.protocol&&"https"!=this.protocol?a.match(/^waptest\.ctrip|^210\.13\.100\.191/i)?"waptest.ctrip.com":"m.ctrip.com":"restful.waptest.ctrip.com":"restful.waptest.ctrip.com",{domain:b,path:c}},h.getInstance=function(){return this.instance instanceof this?this.instance:this.instance=new this},h.CONTENT_TYPE_JSON="json",h.CONTENT_TYPE_FORM="form",h.CONTENT_TYPE_JSONP="jsonp",h});